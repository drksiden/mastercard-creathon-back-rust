# Payment Analytics Backend (Rust)

Backend ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ LLM Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ SQL Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸Ð· ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ·Ñ‹ÐºÐ°.

## ðŸ—ï¸ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

- **Framework**: Axum (async web framework)
- **Database**: PostgreSQL Ñ SQLx
- **LLM**: `rig-core` Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ollama (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾) Ð¸Ð»Ð¸ OpenAI (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
- **Logging**: Tracing

### ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ rig-core?

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ `rig-core` (Ð²ÐµÑ€ÑÐ¸Ñ 0.24) Ð´Ð°ÐµÑ‚ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:

- âœ… **Ð¢Ð¸Ð¿Ð¾Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ** - Ð²ÑÐµ Ñ‚Ð¸Ð¿Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑŽÑ‚ÑÑ Ð½Ð° ÑÑ‚Ð°Ð¿Ðµ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸
- âœ… **Ð£Ð½Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ API** - Ð¾Ð´Ð¸Ð½ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð¾Ð² (Ollama, OpenAI, Anthropic Ð¸ Ð´Ñ€.)
- âœ… **Ð›ÐµÐ³ÐºÐ¾Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ** - ÑÐ¼ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð° Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
- âœ… **Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ streaming** - Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
- âœ… **ÐÐºÑ‚Ð¸Ð²Ð½Ð°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°** - Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð½Ð¾Ð²Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ ÑÐ¼. [LLM_IMPLEMENTATION.md](LLM_IMPLEMENTATION.md)

## ðŸ“‹ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

- Rust 1.70+
- PostgreSQL 15+
- Ollama (Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ LLM) Ð¸Ð»Ð¸ OpenAI API ÐºÐ»ÑŽÑ‡

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### 1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Rust (ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½)
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ PostgreSQL
# ÐÐ° Arch Linux:
sudo pacman -S postgresql

# ÐÐ° Ubuntu/Debian:
sudo apt-get install postgresql postgresql-contrib
```

### 2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

```bash
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ PostgreSQL
sudo systemctl start postgresql

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
sudo -u postgres psql -c "CREATE DATABASE payment_analytics;"
sudo -u postgres psql -c "CREATE USER postgres WITH PASSWORD 'password';"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE payment_analytics TO postgres;"
```

### 3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ollama (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ LLM)

**ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ ÑÐ¼. Ð² [SETUP.md](SETUP.md)**

ÐšÑ€Ð°Ñ‚ÐºÐ¾:
```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ollama
curl -fsSL https://ollama.com/install.sh | sh

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ollama (Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ Ð¸Ð»Ð¸ ÐºÐ°Ðº ÑÐµÑ€Ð²Ð¸Ñ)
ollama serve

# Ð’ Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð¼Ð¾Ð´ÐµÐ»ÑŒ (Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð´Ð½Ñƒ):
ollama pull llama2        # Ð›ÐµÐ³ÐºÐ°Ñ (~4GB)
# Ð¸Ð»Ð¸
ollama pull mistral       # Ð‘Ð°Ð»Ð°Ð½Ñ (~4GB)
# Ð¸Ð»Ð¸
ollama pull mixtral:8x7b-instruct  # ÐœÐ¾Ñ‰Ð½Ð°Ñ (~26GB)
```

**Ð’Ð°Ð¶Ð½Ð¾:** Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½ÑƒÑŽ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð² `.env` Ñ„Ð°Ð¹Ð»Ðµ Ð² Ð¿Ð¾Ð»Ðµ `OLLAMA_MODEL`

### 4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

**Ð’Ð°Ð¶Ð½Ð¾:** ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ `DATABASE_URL` Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°. ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð¼ÐµÑŽÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ.

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env` Ð² ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð¸Ð»Ð¸ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ):

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ Gemini API:**
```env
# ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ
DATABASE_URL=postgresql://user:password@host:5432/dbname
# ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ postgresql+psycopg2:// (Python) Ð±ÑƒÐ´ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½

# LLM Provider
LLM_PROVIDER=gemini

# Gemini API Key (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ GEMINI_API_KEY Ð¸Ð»Ð¸ LLM_API_KEY)
GEMINI_API_KEY=your-api-key-here

# Gemini Model (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ: gemini-2.0-flash-exp)
# Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸: gemini-2.0-flash-exp, gemini-1.5-pro, gemini-1.5-flash
GEMINI_MODEL=gemini-2.0-flash-exp

# Server Configuration
HOST=0.0.0.0
PORT=3000
RUST_LOG=info,payment_analytics_backend=debug
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ Ollama (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ LLM):**
```env
DATABASE_URL=postgresql://postgres:password@localhost:5432/payment_analytics
LLM_PROVIDER=ollama
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=mixtral:8x7b-instruct
HOST=0.0.0.0
PORT=3000
RUST_LOG=info,payment_analytics_backend=debug
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ñ:**
- Ð•ÑÐ»Ð¸ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
- ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° `transactions` Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ñ‹: `ollama`, `openai`, `gemini`
- Ð¡Ð¼. `.env.example` Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…

### 5. Ð—Ð°Ð¿ÑƒÑÐº

```bash
# Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº
cargo run

# Ð˜Ð»Ð¸ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ Ð°Ð²Ñ‚Ð¾Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹
cargo watch -x run
```

Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑÑ Ð½Ð° `http://localhost:3000`

## ðŸ“¡ API Endpoints

### Health Check

```bash
GET /api/health
```

ÐžÑ‚Ð²ÐµÑ‚:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00Z",
  "database": "connected",
  "llm": "ollama"
}
```

### Chat (ÐžÐ±Ñ‹Ñ‡Ð½Ð¾Ðµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼)

```bash
POST /api/chat
Content-Type: application/json

{
  "message": "ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐšÐ°Ðº Ð´ÐµÐ»Ð°?",
  "session_id": "optional-session-id",  // ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾
  "user_id": "optional-user-id"         // ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾
}
```

**ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸:**
- ðŸŒ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑÐ·Ñ‹ÐºÐ° (Ñ€ÑƒÑÑÐºÐ¸Ð¹, Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¸Ð¹, ÐºÐ°Ð·Ð°Ñ…ÑÐºÐ¸Ð¹)
- ðŸ’¬ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑÑÐ¸Ð¸
- ðŸ˜Š Ð”Ñ€ÑƒÐ¶ÐµÐ»ÑŽÐ±Ð½Ð¾Ðµ Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÑÐ¼Ð°Ð¹Ð»Ð¸ÐºÐ¾Ð²

Ð¡Ð¼. [CHAT_API.md](./CHAT_API.md) Ð´Ð»Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸.

### Query (Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ endpoint)

**ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð´Ð²Ð° Ñ‚Ð¸Ð¿Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:**

1. **SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…** - Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ SQL Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ
2. **ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹** - Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚ ÐºÐ°Ðº Ð² Ñ‡Ð°Ñ‚Ðµ, ÐµÑÐ»Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð½Ðµ Ð¿Ñ€Ð¾ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

```bash
POST /api/query
Content-Type: application/json

{
  "question": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð±Ñ‹Ð»Ð¾ Ð² 2024 Ð³Ð¾Ð´Ñƒ?"
}
```

**ÐžÑ‚Ð²ÐµÑ‚ Ð´Ð»Ñ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°:**
```json
{
  "question": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð±Ñ‹Ð»Ð¾ Ð² 2024 Ð³Ð¾Ð´Ñƒ?",
  "sql": "SELECT COUNT(*) as total_transactions FROM transactions WHERE transaction_timestamp >= '2024-01-01' AND transaction_timestamp < '2025-01-01';",
  "data": [
    {
      "total_transactions": 2500
    }
  ],
  "execution_time_ms": 45,
  "row_count": 1
}
```

**ÐžÑ‚Ð²ÐµÑ‚ Ð´Ð»Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð³Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°:**
```json
{
  "question": "ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐšÐ°Ðº Ð´ÐµÐ»Ð°?",
  "text_response": "ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð£ Ð¼ÐµÐ½Ñ Ð²ÑÑ‘ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾, ÑÐ¿Ð°ÑÐ¸Ð±Ð¾! ðŸ˜Š Ð§ÐµÐ¼ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?",
  "data": [],
  "execution_time_ms": 234,
  "row_count": 0
}
```

**ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸:**
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ñ‚Ð¸Ð¿ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ° (SQL Ð¸Ð»Ð¸ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹)
- Ð•ÑÐ»Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¿Ñ€Ð¾ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… â†’ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ SQL Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ
- Ð•ÑÐ»Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ â†’ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `text_response` Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¼ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð¼
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð°Ð½Ð°Ð»Ð¸Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ… (`include_analysis: true`)
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (`use_cache: true`)
- **ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²** - Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 5-10 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð¾ `user_id` Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ³Ð¾ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð±ÐµÑÐµÐ´Ñ‹

**ÐŸÑ€ÐµÑ„Ð¸ÐºÑÑ‹ Ð´Ð»Ñ SQL Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:**
Ð”Ð»Ñ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ SQL Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¾Ð´Ð¸Ð½ Ð¸Ð· Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð²:
- `/sql` - Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: `/sql ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ`
- `#sql` - Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: `#sql Ð¢Ð¾Ð¿ 10 Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð²`
- `sql:` - Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: `sql: Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ Ð²Ð°Ð»ÑŽÑ‚Ð°Ð¼`

Ð‘ÐµÐ· Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸, Ð½Ð¾ Ð´Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ Ð»ÑƒÑ‡ÑˆÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ.

**Ð’Ð°Ð¶Ð½Ð¾ Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ…:**
Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð±Ð°Ð·Ðµ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð½Ð° **Ð»Ð°Ñ‚Ð¸Ð½Ð¸Ñ†Ðµ** (English):
- Ð“Ð¾Ñ€Ð¾Ð´Ð°: `Astana` (Ð½Ðµ ÐÑÑ‚Ð°Ð½Ð°), `Almaty` (Ð½Ðµ ÐÐ»Ð¼Ð°Ñ‚Ñ‹), `Shymkent` (Ð½Ðµ Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚)
- Ð‘Ð°Ð½ÐºÐ¸: `Halyk Bank` (Ð½Ðµ Ð¥Ð°Ð»Ñ‹Ðº Ð‘Ð°Ð½Ðº), `Kaspi Bank` (Ð½Ðµ ÐšÐ°ÑÐ¿Ð¸ Ð‘Ð°Ð½Ðº)
- Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÑ‚ ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†Ñƒ Ð² Ð»Ð°Ñ‚Ð¸Ð½Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ SQL

### ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… 5-10 SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (Ð¿Ð¾ `user_id`). Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚:

- ÐŸÐ¾Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ ("Ð¿Ð¾ÐºÐ°Ð¶Ð¸ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð¿Ð¾ ÑÑ‚Ð¾Ð¼Ñƒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ")
- Ð£Ð»ÑƒÑ‡ÑˆÐ°Ñ‚ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ SQL-Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð´Ð¸Ð°Ð»Ð¾Ð³ Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

**ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°:**

```bash
POST /api/context/clear
Content-Type: application/json

{
  "user_id": "user123"
}
```

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°:**

ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ð¹Ñ‚Ðµ `user_id` Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ:

```bash
POST /api/query
Content-Type: application/json

{
  "question": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð±Ñ‹Ð»Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ?",
  "user_id": "user123"
}
```

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°.

### ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð²

**Ð¡ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ°Ð¼Ð¸ SQL (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ):**
- `/sql Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð±Ñ‹Ð»Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ?`
- `/sql Ð¢Ð¾Ð¿ 10 Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² Ð¿Ð¾ Ð¾Ð±ÑŠÐµÐ¼Ñƒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹`
- `/sql Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ‡ÐµÐº Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚ Halyk Bank Ð² Almaty`
- `/sql ÐžÐ±ÑŠÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ MCC Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¼ÐµÑÑÑ†`
- `/sql Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¾Ð² (Apple Pay, Google Pay)`
- `/sql Ð”Ð½ÐµÐ²Ð½Ð¾Ð¹ Ð¾Ð±ÑŠÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹`

**Ð‘ÐµÐ· Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð² (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ):**
- "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð±Ñ‹Ð»Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ?"
- "Ð¢Ð¾Ð¿ 10 Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² Ð¿Ð¾ Ð¾Ð±ÑŠÐµÐ¼Ñƒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹"
- "Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ‡ÐµÐº Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚ Halyk Bank Ð² ÐÐ»Ð¼Ð°Ñ‚Ñ‹" (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÑ‚ÑÑ Ð² Almaty)
- "ÐžÐ±ÑŠÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ MCC Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¼ÐµÑÑÑ†"
- "Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¾Ð² (Apple Pay, Google Pay)"
- "Ð”Ð½ÐµÐ²Ð½Ð¾Ð¹ Ð¾Ð±ÑŠÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹"
- "Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ATM_WITHDRAWAL Ð¸ POS Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹"
- "P2P Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð¸ Ð¸ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ)"
- "Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ð²Ð°Ð»ÑŽÑ‚Ð°Ð¼ (KZT, USD, EUR Ð¸ Ð´Ñ€.)"
- "Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð°Ð¼ (KAZ, USA, RUS Ð¸ Ð´Ñ€.)"

**Ð’Ð°Ð¶Ð½Ð¾:** ÐŸÑ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ñ… Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ð°Ñ… Ð¸Ð»Ð¸ Ð±Ð°Ð½ÐºÐ°Ñ… Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ðº ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†Ñƒ, Ñ‚Ð°Ðº Ð¸ Ð»Ð°Ñ‚Ð¸Ð½Ð¸Ñ†Ñƒ - ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÑ‚ Ð² Ð»Ð°Ñ‚Ð¸Ð½Ð¸Ñ†Ñƒ Ð´Ð»Ñ SQL Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð².

## ðŸ—„ï¸ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹

- **transactions**: ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹
  - `id`: SERIAL PRIMARY KEY
  - `transaction_id`: Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
  - `transaction_timestamp`: Ð’Ñ€ÐµÐ¼Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
  - `card_id`: Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ ÐºÐ°Ñ€Ñ‚Ñ‹
  - `expiry_date`: Ð¡Ñ€Ð¾Ðº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ÐºÐ°Ñ€Ñ‚Ñ‹ (MM/YY)
  - `issuer_bank_name`: Ð‘Ð°Ð½Ðº-ÑÐ¼Ð¸Ñ‚ÐµÐ½Ñ‚ ÐºÐ°Ñ€Ñ‚Ñ‹
  - `merchant_id`: Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¼ÐµÑ€Ñ‡Ð°Ð½Ñ‚Ð°
  - `merchant_mcc`: Merchant Category Code
  - `mcc_category`: ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ MCC (Clothing & Apparel, Dining & Restaurants, Electronics & Software, Fuel & Service Stations, General Retail & Department, Grocery & Food Markets, Hobby Books Sporting Goods, Home Furnishings & Supplies, Pharmacies & Health, Services (Other), Travel & Transportation, Unknown, Utilities & Bill Payments)
  - `merchant_city`: Ð“Ð¾Ñ€Ð¾Ð´ Ð¼ÐµÑ€Ñ‡Ð°Ð½Ñ‚Ð°
  - `transaction_type`: Ð¢Ð¸Ð¿ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (ATM_WITHDRAWAL, BILL_PAYMENT, ECOM, P2P_IN, P2P_OUT, POS, SALARY)
  - `transaction_amount_kzt`: Ð¡ÑƒÐ¼Ð¼Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð² KZT
  - `original_amount`: ÐžÑ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑƒÐ¼Ð¼Ð° (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð° ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ñ Ð²Ð°Ð»ÑŽÑ‚)
  - `transaction_currency`: Ð’Ð°Ð»ÑŽÑ‚Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (AMD, BYN, CNY, EUR, GEL, KGS, KZT, TRY, USD, UZS)
  - `acquirer_country_iso`: ISO ÐºÐ¾Ð´ ÑÑ‚Ñ€Ð°Ð½Ñ‹ ÑÐºÐ²Ð°Ð¹ÐµÑ€Ð° (ARM, BLR, CHN, GEO, ITA, KAZ, KGZ, TUR, USA, UZB)
  - `pos_entry_mode`: Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð²Ð²Ð¾Ð´Ð° (Contactless, ECOM, QR_Code, Swipe, Ð¸Ð»Ð¸ NULL)
  - `wallet_type`: Ð¢Ð¸Ð¿ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ° (Apple Pay, Google Pay, Samsung Pay, Ð¸Ð»Ð¸ NULL)

- **query_audit_log**: Ð›Ð¾Ð³ Ð²ÑÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð´Ð»Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð°
  - `id`: SERIAL PRIMARY KEY
  - `user_id`: Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  - `question`: Ð’Ð¾Ð¿Ñ€Ð¾Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  - `generated_sql`: Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ
  - `success`: Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
  - `error_message`: Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
  - `execution_time_ms`: Ð’Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð² Ð¼Ð¸Ð»Ð»Ð¸ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…
  - `created_at`: Ð’Ñ€ÐµÐ¼Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸

### ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° `transactions` Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…. 
Ð•ÑÐ»Ð¸ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑƒÐ¶Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ñ‹.

ÐŸÑ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ (ÐµÑÐ»Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ† Ð½ÐµÑ‚) ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° `transactions` Ð¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ 5000 Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹.

## ðŸ”§ Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

```
src/
â”œâ”€â”€ main.rs          # Ð¢Ð¾Ñ‡ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°
â”œâ”€â”€ config.rs        # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
â”œâ”€â”€ error.rs         # ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
â”œâ”€â”€ state.rs         # Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
â”œâ”€â”€ db/              # Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð‘Ð”
â”‚   â”œâ”€â”€ pool.rs
â”‚   â”œâ”€â”€ queries.rs
â”‚   â””â”€â”€ mock_data.rs
â”œâ”€â”€ llm/             # LLM ÐºÐ»Ð¸ÐµÐ½Ñ‚ (Ñ‡ÐµÑ€ÐµÐ· rig-core)
â”‚   â”œâ”€â”€ client.rs    # rig-core Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ
â”‚   â”œâ”€â”€ prompts.rs
â”‚   â””â”€â”€ validator.rs
â”œâ”€â”€ api/             # API endpoints
â”‚   â”œâ”€â”€ health.rs
â”‚   â”œâ”€â”€ query.rs
â”‚   â””â”€â”€ models.rs
â””â”€â”€ utils/           # Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹
    â”œâ”€â”€ logger.rs
    â””â”€â”€ metrics.rs
```

### Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

```bash
# Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²
cargo test

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð´Ð°
cargo clippy

# Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
cargo fmt
```

## ðŸ› Troubleshooting

### ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð‘Ð”

Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:
- PostgreSQL Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½: `sudo systemctl status postgresql`
- Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð·Ð´Ð°Ð½Ð°
- `DATABASE_URL` Ð² `.env` Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹

### ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ollama

Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:
- Ollama Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½: `ollama serve`
- ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð°: `ollama list`
- `OLLAMA_URL` Ð² `.env` Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸

```bash
# Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
psql -U postgres -d payment_analytics -f migrations/001_init.sql
```

## ðŸ“ TODO

- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑŽ
- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ streaming Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² (rig-core Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚)
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
- [ ] Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ SQL
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ (Prometheus)
- [ ] Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ OpenAI fallback (Ð·Ð°Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ)
- [ ] Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ function calling Ñ‡ÐµÑ€ÐµÐ· rig-core

## ðŸ“„ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

MIT


# ü¶ô –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Ollama

## –ö–æ–º–∞–Ω–¥—ã Ollama CLI

Ollama –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏:

- `/set` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- `/show` - –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥–µ–ª–∏
- `/load <model>` - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Å—Å–∏—é –∏–ª–∏ –º–æ–¥–µ–ª—å
- `/save <model>` - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
- `/clear` - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Å—Å–∏–∏
- `/bye` - –í—ã–π—Ç–∏

## üîÑ –ö–∞–∫ —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ

### –ß–µ—Ä–µ–∑ rig-core API

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `rig-core`, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Ollama API, –∞ –Ω–µ CLI. –ù–æ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**Ollama CLI:** `/save <model>`  
**–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞:** –•—Ä–∞–Ω–∏—Ç—å `chat_history` –≤ —Å–µ—Å—Å–∏—è—Ö

```rust
// –ë—É–¥—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
pub struct Session {
    pub session_id: String,
    pub chat_history: Vec<Message>,  // –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
    pub model: String,
    pub created_at: DateTime<Utc>,
}
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–∏

**Ollama CLI:** `/load <model>`  
**–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞:** –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑ —Å–µ—Å—Å–∏–∏

```rust
// –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å session_id
if let Some(session) = session_manager.get(&session_id).await {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑ —Å–µ—Å—Å–∏–∏
    let history = &session.chat_history;
    // –î–æ–±–∞–≤–ª—è–µ–º –∫ CompletionRequest
}
```

### 3. –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**Ollama CLI:** `/clear`  
**–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞:** –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–µ—Å—Å–∏–∏

```rust
// API endpoint
POST /api/session/{session_id}/clear
```

### 4. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

**Ollama CLI:** `/load <model>`  
**–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞:** –£–∫–∞–∑–∞—Ç—å –º–æ–¥–µ–ª—å –≤ –∑–∞–ø—Ä–æ—Å–µ

```json
{
  "question": "...",
  "model": "mixtral:8x7b-instruct",  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é
  "include_analysis": true
}
```

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä 1: –î–∏–∞–ª–æ–≥ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–µ–≥–æ–¥–Ω—è?"
–ë–æ—Ç: "1523 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ê –≤—á–µ—Ä–∞?"  // –ü–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å—Ç–æ—Ä–∏–∏
–ë–æ—Ç: "–í—á–µ—Ä–∞ –±—ã–ª–æ 1456 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ–∫–∞–∂–∏ –¥–∏–Ω–∞–º–∏–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é"  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–∏–∞–ª–æ–≥
–ë–æ—Ç: [–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É]
```

### –ü—Ä–∏–º–µ—Ä 2: –£—Ç–æ—á–Ω–µ–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π MCC"
–ë–æ—Ç: [–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø-5]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–î–µ—Ç–∞–ª–∏ –ø–æ –ø–µ—Ä–≤–æ–π"  // –ü–æ–Ω–∏–º–∞–µ—Ç "–ø–µ—Ä–≤–∞—è" = –ø–µ—Ä–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
–ë–æ—Ç: [–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –ø–æ Dining & Restaurants]
```

## üöÄ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–±—É–¥—É—â–µ–µ)

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å session_id –≤ API

```rust
#[derive(Debug, Deserialize)]
pub struct QueryRequest {
    pub question: String,
    #[serde(default)]
    pub session_id: Option<String>,  // –ù–æ–≤–æ–µ –ø–æ–ª–µ
    #[serde(default)]
    pub include_analysis: bool,
    #[serde(default)]
    pub use_cache: bool,
}
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å SessionManager

```rust
pub struct SessionManager {
    sessions: Arc<RwLock<HashMap<String, Session>>>,
}

impl SessionManager {
    pub async fn get_or_create(&self, session_id: &str) -> Session {
        // –ü–æ–ª—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é
    }
    
    pub async fn add_message(&self, session_id: &str, message: Message) {
        // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
    }
    
    pub async fn clear(&self, session_id: &str) {
        // –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
    }
}
```

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ LLM

```rust
pub async fn generate_sql_with_context(
    &self,
    question: &str,
    history: &[Message],
) -> Result<String> {
    // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –∫ –∑–∞–ø—Ä–æ—Å—É
    let mut chat_history = history.to_vec();
    chat_history.push(Message::User {
        content: OneOrMany::one(UserContent::text(question)),
    });
    
    let request = CompletionRequest {
        chat_history: OneOrMany::many(chat_history),
        // ...
    };
}
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

1. **–ü–æ–Ω–∏–º–∞–Ω–∏–µ —É—Ç–æ—á–Ω–µ–Ω–∏–π**
   - "–ê –≤—á–µ—Ä–∞?" –≤–º–µ—Å—Ç–æ "–°–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤—á–µ—Ä–∞?"
   - "–î–µ—Ç–∞–ª–∏ –ø–æ –ø–µ—Ä–≤–æ–π" –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

2. **–ë–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –ë–æ—Ç "–ø–æ–º–Ω–∏—Ç" –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

3. **–õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
   - LLM –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏**
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10-20 —Å–æ–æ–±—â–µ–Ω–∏–π
   - –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ë–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ = –º–µ–¥–ª–µ–Ω–Ω–µ–µ
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ**
   - –í –ø–∞–º—è—Ç–∏ - –±—ã—Å—Ç—Ä–æ, –Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
   - –í Redis - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –Ω–∞—á–∞–ª–∞:

1. **–•—Ä–∞–Ω–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ** (Telegram –±–æ—Ç, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
2. **–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5-10 —Å–æ–æ–±—â–µ–Ω–∏–π** —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à** –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–ª—è production:

1. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**
2. **–•—Ä–∞–Ω–∏—Ç–µ –≤ Redis** (–¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è)
3. **TTL –¥–ª—è —Å–µ—Å—Å–∏–π** (1 —á–∞—Å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)

## üîó –°–≤—è–∑—å —Å Ollama CLI

| Ollama CLI | –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ (—á–µ—Ä–µ–∑ rig-core) |
|------------|-------------------------------|
| `/save <model>` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é —Å –∏—Å—Ç–æ—Ä–∏–µ–π |
| `/load <model>` | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Å—Å–∏—é |
| `/clear` | –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–µ—Å—Å–∏–∏ |
| `/set` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ |

**–ò—Ç–æ–≥:** –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏ Ollama CLI –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ `rig-core` API –∏ —Å–µ—Å—Å–∏–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.


# üìä –§–æ—Ä–º–∞—Ç—ã –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

–î–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è, —á—Ç–æ –≤–æ–ø—Ä–æ—Å —è–≤–ª—è–µ—Ç—Å—è SQL-–∑–∞–ø—Ä–æ—Å–æ–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã:

- `/sql` - –∫–æ–º–∞–Ω–¥–∞-—Å—Ç–∏–ª—å
- `#sql` - —Ö–µ—à—Ç–µ–≥-—Å—Ç–∏–ª—å  
- `sql:` - –ø—Ä–µ—Ñ–∏–∫—Å-—Å—Ç–∏–ª—å

### –ü—Ä–∏–º–µ—Ä—ã:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –∫–æ–º–∞–Ω–¥–∞
curl -X POST http://localhost:3000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "/sql –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –¥–Ω—è–º"
  }'

# –í–∞—Ä–∏–∞–Ω—Ç 2: —Ö–µ—à—Ç–µ–≥
curl -X POST http://localhost:3000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "#sql –°–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±—ã–ª–æ —Å–µ–≥–æ–¥–Ω—è?"
  }'

# –í–∞—Ä–∏–∞–Ω—Ç 3: –ø—Ä–µ—Ñ–∏–∫—Å
curl -X POST http://localhost:3000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "sql: –¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π MCC"
  }'
```

## –¢–∏–ø—ã –≤—ã–≤–æ–¥–∞ (`output_type`)

### `auto` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö:
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö 1-5 —Å—Ç—Ä–æ–∫ ‚Üí —Ç–∞–±–ª–∏—Ü–∞
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö 6-20 —Å—Ç—Ä–æ–∫ ‚Üí —Ç–∞–±–ª–∏—Ü–∞ + –¥–∏–∞–≥—Ä–∞–º–º–∞ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö > 20 —Å—Ç—Ä–æ–∫ ‚Üí —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞

### `table`
–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –≤ Markdown —Ñ–æ—Ä–º–∞—Ç–µ.

### `chart`
–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ).

### `json`
–¢–æ–ª—å–∫–æ —Å—ã—Ä—ã–µ JSON –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è).

## –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```json
{
  "question": "–ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –¥–Ω—è–º",
  "sql": "SELECT ...",
  "data": [
    {"date": "2024-01-01", "count": 150},
    {"date": "2024-01-02", "count": 200}
  ],
  "table": "| date | count |\n| --- | --- |\n| 2024-01-01 | 150 |\n| 2024-01-02 | 200 |",
  "chart_data": {
    "chart_type": "line",
    "labels": ["2024-01-01", "2024-01-02"],
    "datasets": [
      {
        "label": "count",
        "data": [150.0, 200.0]
      }
    ]
  },
  "row_count": 2,
  "execution_time_ms": 150
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –¢–∞–±–ª–∏—Ü–∞ (Markdown)

```bash
curl -X POST http://localhost:3000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "/sql –¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π MCC",
    "output_type": "table",
    "include_sql": false
  }'
```

–û—Ç–≤–µ—Ç:
```json
{
  "table": "| mcc_category | count |\n| --- | --- |\n| Dining & Restaurants | 523 |\n| Grocery & Food Markets | 412 |"
}
```

### 2. –î–∏–∞–≥—Ä–∞–º–º–∞ (Chart.js —Ñ–æ—Ä–º–∞—Ç)

```bash
curl -X POST http://localhost:3000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "/sql –î–∏–Ω–∞–º–∏–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –¥–Ω—è–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",
    "output_type": "chart"
  }'
```

–û—Ç–≤–µ—Ç:
```json
{
  "chart_data": {
    "chart_type": "line",
    "labels": ["2024-01-01", "2024-01-02", "2024-01-03"],
    "datasets": [
      {
        "label": "count",
        "data": [150.0, 200.0, 180.0]
      }
    ]
  }
}
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä

```bash
curl -X POST http://localhost:3000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "/sql –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –≤–∞–ª—é—Ç–∞–º",
    "output_type": "auto",
    "include_analysis": true
  }'
```

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã (pie –¥–ª—è –≤–∞–ª—é—Ç)
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### React + Chart.js

```tsx
import { Line } from 'react-chartjs-2';

function ChartComponent({ chartData }) {
  if (!chartData) return null;
  
  const config = {
    labels: chartData.labels,
    datasets: chartData.datasets.map(ds => ({
      label: ds.label,
      data: ds.data,
      backgroundColor: ds.background_color || 'rgba(75, 192, 192, 0.2)',
      borderColor: ds.background_color || 'rgba(75, 192, 192, 1)',
    }))
  };
  
  return <Line data={config} />;
}
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

```tsx
import ReactMarkdown from 'react-markdown';

function TableComponent({ table }) {
  if (!table) return null;
  
  return <ReactMarkdown>{table}</ReactMarkdown>;
}
```

## Telegram –±–æ—Ç

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –≤—ã–≤–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `output_type`
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è Telegram
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

## –¢–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- `bar` - —Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
- `line` - –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
- `pie` - –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
- `table` - —Ç–∞–±–ª–∏—Ü–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

–¢–∏–ø –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
- –ù–∞–ª–∏—á–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π LLM –∞–Ω–∞–ª–∏–∑–∞

